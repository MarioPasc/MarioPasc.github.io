<!-- Syntax Highlighter for Code Blocks -->
<style>
.code-block {
  background: #f8f8f8;
  border: 1px solid #e1e1e1;
  border-radius: 4px;
  padding: 1rem;
  margin: 1rem 0;
  overflow-x: auto;
  font-family: 'Courier New', monospace;
  font-size: 14px;
  line-height: 1.4;
  position: relative;
}

.code-block::before {
  content: attr(data-lang);
  position: absolute;
  top: 0.5rem;
  right: 0.5rem;
  font-size: 0.75rem;
  color: #666;
  background: #fff;
  padding: 0.2rem 0.4rem;
  border-radius: 3px;
  border: 1px solid #ddd;
  text-transform: uppercase;
}

.code-block .keyword { color: #d73a49; font-weight: bold; }
.code-block .string { color: #032f62; }
.code-block .comment { color: #6a737d; font-style: italic; }
.code-block .number { color: #005cc5; }
.code-block .function { color: #6f42c1; font-weight: bold; }
.code-block .operator { color: #d73a49; }
.code-block .preprocessor { color: #d73a49; }
.code-block .built-in { color: #005cc5; }

/* Theme for pre code blocks */
pre code {
  display: block;
  background: #f8f8f8;
  padding: 1rem;
  border-radius: 4px;
  overflow-x: auto;
  font-family: 'Courier New', monospace;
  font-size: 14px;
  line-height: 1.4;
}
</style>

<script>
function highlightCode() {
  // Handle both .code-block and pre code elements
  document.querySelectorAll('.code-block code, pre code, code[data-lang]').forEach(function(block) {
    // Skip if already highlighted
    if (block.classList.contains('highlighted')) return;
    
    let lang = block.getAttribute('data-lang') || 
               block.className.replace('language-', '') || 
               block.parentElement.className.replace('language-', '') || 
               'python';
    
    let code = block.textContent || block.innerText;
    
    // Add language indicator to parent
    if (block.parentElement.classList.contains('code-block')) {
      block.parentElement.setAttribute('data-lang', lang);
    }

    if (lang === 'python') {
      // Python syntax highlighting with improved patterns
      code = code
        // Comments first (to avoid conflicts)
        .replace(/(#.*$)/gm, '<span class="comment">$1</span>')
        // Triple quoted strings
        .replace(/("""[\s\S]*?""")/g, '<span class="string">$1</span>')
        .replace(/('''[\s\S]*?''')/g, '<span class="string">$1</span>')
        // Regular strings
        .replace(/(['"])((?:\\.|(?!\1)[^\\])*)\1/g, '<span class="string">$1$2$1</span>')
        // Built-in functions
        .replace(/\b(print|len|range|enumerate|zip|map|filter|sum|max|min|abs|round)\b/g, '<span class="built-in">$1</span>')
        // Keywords
        .replace(/\b(def|class|if|else|elif|for|while|try|except|finally|import|from|return|break|continue|pass|lambda|with|as|in|not|and|or|is|None|True|False|global|nonlocal|yield|async|await)\b/g, '<span class="keyword">$1</span>')
        // Numbers
        .replace(/\b(\d+\.?\d*)\b/g, '<span class="number">$1</span>');
        
    } else if (lang === 'cpp' || lang === 'c++') {
      code = code
        // Comments
        .replace(/(\/\/.*$|\/\*[\s\S]*?\*\/)/gm, '<span class="comment">$1</span>')
        // Strings
        .replace(/(["'])((?:\\.|(?!\1)[^\\])*)\1/g, '<span class="string">$1$2$1</span>')
        // Preprocessor directives
        .replace(/(#\w+)/g, '<span class="preprocessor">$1</span>')
        // Keywords
        .replace(/\b(int|float|double|char|bool|void|string|auto|const|static|class|struct|enum|namespace|using|if|else|for|while|do|switch|case|default|break|continue|return|public|private|protected|virtual|override|template|typename|sizeof|new|delete|this|true|false|nullptr)\b/g, '<span class="keyword">$1</span>')
        // Standard library functions
        .replace(/\b(cout|cin|endl|printf|scanf|malloc|free|sizeof)\b/g, '<span class="built-in">$1</span>')
        // Numbers
        .replace(/\b(\d+\.?\d*f?)\b/g, '<span class="number">$1</span>');
        
    } else if (lang === 'javascript' || lang === 'js') {
      code = code
        // Comments
        .replace(/(\/\/.*$|\/\*[\s\S]*?\*\/)/gm, '<span class="comment">$1</span>')
        // Strings
        .replace(/(["'`])((?:\\.|(?!\1)[^\\])*)\1/g, '<span class="string">$1$2$1</span>')
        // Keywords
        .replace(/\b(function|var|let|const|if|else|for|while|do|switch|case|break|continue|return|class|extends|constructor|super|this|new|typeof|instanceof|true|false|null|undefined|async|await|try|catch|finally|throw)\b/g, '<span class="keyword">$1</span>')
        // Built-in functions/objects
        .replace(/\b(console|document|window|Array|Object|String|Number|Boolean|Date|Math|JSON|Promise)\b/g, '<span class="built-in">$1</span>')
        // Numbers
        .replace(/\b(\d+\.?\d*)\b/g, '<span class="number">$1</span>');
    }
    
    block.innerHTML = code;
    block.classList.add('highlighted');
  });
}

// Run on page load and when content changes
document.addEventListener('DOMContentLoaded', highlightCode);

// For dynamic content
const observer = new MutationObserver(function(mutations) {
  mutations.forEach(function(mutation) {
    if (mutation.addedNodes.length > 0) {
      highlightCode();
    }
  });
});

observer.observe(document.body, {
  childList: true,
  subtree: true
});
</script>